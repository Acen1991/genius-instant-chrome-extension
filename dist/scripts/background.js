"use strict";function normalize(a){var b=a.toLowerCase(),c=/(\[|\().*(\)|\])/i;b=b.replace(c,""),b=b.replace(/\s+/," "),b=b.trim();var d=b.match(/((ft\.|feat\.|featuring|\sfeat\s)[^\-]*\s)-\s/);b=d&&d.length>1?b.replace(d[1],""):b;var e=b.match(/-[\w\W]*(\s?(ft\.|feat\.|featuring|\sfeat\s)[\w\W]*)/);b=e&&e.length>1?b.replace(e[1],""):b;var f=b.match(/[\w\W]+ - [\w\W]+ (- [\w\W]+)/);return b=f&&f.length>1?b.replace(f[1],""):b,b=b.replace(/[\"\«\»]/g," "),b=b.replace(/\s\s+/g," "),b=b.trim(),console.log("before normalization : "+a+", after normalization : "+b),b}function mostSuitableGeniusSong(a,b){for(var c=0,d=Number.MAX_SAFE_INTEGER,e=0,f=b.length;f>e;e++){var g=b[e].result,h=normalize(g.primary_artist.name+" "+g.title),i=LevenshteinDistance(a,h);d>i&&(d=i,c=e)}return b[c].result}function LevenshteinDistance(a,b,c){c=c||{},isNaN(c.insertion_cost)&&(c.insertion_cost=1),isNaN(c.deletion_cost)&&(c.deletion_cost=1),isNaN(c.substitution_cost)&&(c.substitution_cost=1);for(var d=a.length,e=b.length,f=[[0]],g=1;d>=g;g++)f[g]=[],f[g][0]=f[g-1][0]+c.deletion_cost;for(var h=1;e>=h;h++)f[0][h]=f[0][h-1]+c.insertion_cost;for(var g=1;d>=g;g++)for(var h=1;e>=h;h++){var i=f[g][h-1]+c.insertion_cost,j=f[g-1][h]+c.deletion_cost,k=a[g-1],l=b[h-1],m=f[g-1][h-1];k!==l&&(m+=c.substitution_cost),f[g][h]=Math.min(i,j,m)}return f[d][e]}chrome.runtime.onInstalled.addListener(function(a){console.log("previousVersion",a.previousVersion)}),chrome.browserAction.onClicked.addListener(function(a){chrome.tabs.query({active:!0,currentWindow:!0},function(a){chrome.tabs.sendMessage(a[0].id,{action:"fetchSong"},function(a){"sendSong"==a.action&&!function(){var b=encodeURIComponent(normalize(a.song)),c="OElEA-q64Qtuynf70UHumI_YqVs6MwnRlog8QTkqjM_tmsWAv0_cTIn0pdTzs3IT";fetch("https://api.genius.com/search?access_token="+c+"&q="+b).then(function(a){a.json().then(function(a){if(a&&a.response&&a.response.hits&&a.response.hits.length>0){var c=mostSuitableGeniusSong(b,a.response.hits),d=c.url;chrome.tabs.create({url:d})}})})["catch"](function(a){console.log("Fetch Error :-S",a)})}()})})});