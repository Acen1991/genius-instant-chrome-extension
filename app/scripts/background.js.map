{"version":3,"sources":["../scripts.babel/background.js"],"names":[],"mappings":"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","file":"background.js","sourcesContent":["'use strict';\n\n\nchrome.runtime.onInstalled.addListener(details => {\n  console.log('previousVersion', details.previousVersion);\n});\n\nchrome.browserAction.onClicked.addListener(tab => {\n\tchrome.tabs.query({active: true, currentWindow: true}, tabs => {\n\t\tchrome.tabs.sendMessage(tabs[0].id, {\n\t\t\taction: \"fetchSong\" \n\t\t}, response => {\n\t\t\tif(response.action == \"sendSong\"){\n\t\t\t\tconst normalizedYoutubeTitle = encodeURIComponent(normalize(response.song));\n\t\t\t\tconst access_token = \"OElEA-q64Qtuynf70UHumI_YqVs6MwnRlog8QTkqjM_tmsWAv0_cTIn0pdTzs3IT\";\n\n\t\t\t\tfetch(`https://api.genius.com/search?access_token=${access_token}&q=${normalizedYoutubeTitle}`)\n\t\t\t\t.then(response => {\n\t\t\t\t\tresponse.json().then(res => {\n\t\t\t\t\t\tif(res && res.response && res.response.hits && res.response.hits.length > 0){\n\t\t\t\t\t    \tlet mostSuitableHit = mostSuitableGeniusSong(normalizedYoutubeTitle, res.response.hits);\n                            let action_url = mostSuitableHit.url;\n\t\t\t\t\t    \tchrome.tabs.create({ url: action_url });\t\n\t\t\t\t\t    }\t\t\t\t\t\n\t\t\t\t\t});\n\t\t\t\t})\n                .catch(err => {  \n\t\t\t\t    console.log('Fetch Error :-S', err);  \n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t});\n});\n\n//@FIXME : Can always be improved !\nfunction normalize(token) {\n    let normalizedToken = token.toLowerCase();\n    const pointlessWords = /(\\[|\\().*(\\)|\\])/i;\n\n    normalizedToken = normalizedToken.replace(pointlessWords, '');\n    normalizedToken = normalizedToken.replace(/\\s+/, ' ');\n    normalizedToken = normalizedToken.trim();\n\n    //Removing all featurings\n    const beforeDashFeaturings =  normalizedToken.match(/((ft\\.|feat\\.|featuring|\\sfeat\\s)[^\\-]*\\s)-\\s/);\n    normalizedToken = (beforeDashFeaturings && beforeDashFeaturings.length > 1 ) ? normalizedToken.replace(beforeDashFeaturings[1], '') : normalizedToken;\n\n    const afterDashFeaturings = normalizedToken.match(/-[\\w\\W]*(\\s?(ft\\.|feat\\.|featuring|\\sfeat\\s)[\\w\\W]*)/);\n    normalizedToken = (afterDashFeaturings && afterDashFeaturings.length > 1) ? normalizedToken.replace(afterDashFeaturings[1], '') : normalizedToken;\n\n    const otherDashElements = normalizedToken.match(/[\\w\\W]+ - [\\w\\W]+ (- [\\w\\W]+)/);\n    normalizedToken = (otherDashElements && otherDashElements.length>1) ? normalizedToken.replace(otherDashElements[1], '') : normalizedToken;\n\n    normalizedToken = normalizedToken.replace(/[\\\"\\«\\»]/g, ' ');\n\n    normalizedToken = normalizedToken.replace(/\\s\\s+/g, ' ');\n    \n    normalizedToken = normalizedToken.trim();\n\n    console.log(`before normalization : ${token}, after normalization : ${normalizedToken}`);\n    \n    return normalizedToken;\n}\n\nfunction mostSuitableGeniusSong(youtubeTitle, geniusSongs) {\n\tlet iMinLev = 0;\n    let minLev = Number.MAX_SAFE_INTEGER;\n\n    for (let i = 0, songsLength = geniusSongs.length; i < songsLength; i++) {\n    \tconst result = geniusSongs[i].result;\n        const geniusSongNormalized = normalize(result.primary_artist.name + \" \" + result.title);\n        const currentLev = LevenshteinDistance(youtubeTitle, geniusSongNormalized);\n\n        if (currentLev < minLev) {\n            minLev = currentLev;\n            iMinLev = i;\n        }\n    }\n\n    return geniusSongs[iMinLev].result;\n}\n\n\nfunction LevenshteinDistance (source, target, options) {\n    options = options || {};\n    if(isNaN(options.insertion_cost)) options.insertion_cost = 1;\n    if(isNaN(options.deletion_cost)) options.deletion_cost = 1;\n    if(isNaN(options.substitution_cost)) options.substitution_cost = 1;\n\n    var sourceLength = source.length;\n    var targetLength = target.length;\n    var distanceMatrix = [[0]];\n\n    for (var row =  1; row <= sourceLength; row++) {\n        distanceMatrix[row] = [];\n        distanceMatrix[row][0] = distanceMatrix[row-1][0] + options.deletion_cost;\n    }\n\n    for (var column = 1; column <= targetLength; column++) {\n        distanceMatrix[0][column] = distanceMatrix[0][column-1] + options.insertion_cost;\n    }\n\n    for (var row = 1; row <= sourceLength; row++) {\n        for (var column = 1; column <= targetLength; column++) {\n            var costToInsert = distanceMatrix[row][column-1] + options.insertion_cost;\n            var costToDelete = distanceMatrix[row-1][column] + options.deletion_cost;\n\n            var sourceElement = source[row-1];\n            var targetElement = target[column-1];\n            var costToSubstitute = distanceMatrix[row-1][column-1];\n            if (sourceElement !== targetElement) {\n                costToSubstitute = costToSubstitute + options.substitution_cost;\n            }\n            distanceMatrix[row][column] = Math.min(costToInsert, costToDelete, costToSubstitute);\n        }\n    }\n    return distanceMatrix[sourceLength][targetLength];\n}\n"]}